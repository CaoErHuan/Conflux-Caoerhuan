from phe import paillier
import json
import sys
import urllib.request
import urllib.parse
import time

p = 2073858748171673411122309352056488163669572986503842192023546564122875707803609965065527185558114630110760150208881830879320025811817853349357254119754846845776912171788301502183341612228570406722016068283487628916639003661218111321336366680611111144011171656960310078378697575858018833215233859539403714904487285618905205529805224704444258037504191081875159686323550481470670332036820281032077890822735817217324670351462770064330438656521127017958958187599079611
q = 2245493138294782369545049425872455017499632741652068313684742703030482700581007798478076680581238347242889928263754083879052879779707981901826700159557129484408546682847500614185754627110927089198193543487560839521403394001254646318716288993011386670222351929173201622065132703557061164630279586729125626530239537986560010800322015070710398525080029143583518562770416475662775582649080517659891400702456091439590886560863597700662479831708300693393892803948630251
n =p*q
public_key = paillier.PaillierPublicKey(n)
private_key = paillier.PaillierPrivateKey(public_key, p, q)
index5 = 0


while 1:
    #数值
    index1 = 23.1
    index2 = 47
    index3 = 121.856088
    index4 = 36.942836
    lasttime = index5
    index5 = int(time.time())
    #加密
    number_c = public_key.encrypt(index1).ciphertext()
    number_e = public_key.encrypt(index1).exponent
    h_c = public_key.encrypt(index2).ciphertext()
    h_e = public_key.encrypt(index2).exponent
    x=index3
    y=index4
    t=index5

    url='http://47.93.102.224/other/getData?number_c={number_c}&&number_e={number_e}&&h_c={h_c}&&h_e={h_e}&&x={x}&&y={y}&&t={t}'.format(number_c=number_c,number_e=number_e,h_c=h_c,h_e=h_e,x=x,y=y,t=t)

    timegap = index5-lasttime
    f = urllib.request.urlopen(url)
    print("数据成功上传，间隔：{timegap}秒，当前时间：{index5}".format(timegap=timegap,index5=index5))

# aaaa = paillier.EncryptedNumber(public_key,number_c,number_e)

# answer_ = private_key.decrypt(aaaa)
# print(answer_)










